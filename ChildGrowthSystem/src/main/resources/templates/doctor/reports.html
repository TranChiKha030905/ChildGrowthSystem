<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Patient Reports - Child Growth Tracking</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <div class="container">
        <h1>Patient Reports</h1>
        
        <div class="actions">
            <a th:href="@{/doctor/dashboard}" class="btn btn-secondary">Back to Dashboard</a>
        </div>

        <div class="section">
            <h2>Select Patient</h2>
            <form th:action="@{/doctor/reports}" method="get" class="form" 
                <div class="form-group">
                    <label for="patientId">Patient</label>
                    <select id="patientId" name="patientId" class="form-control" onchange="this.form.submit()">
                        <option value="">Select a patient</option>
                        <option th:each="patient : ${patients}" 
                                th:value="${patient.id}" 
                                th:text="${patient.name}"
                                th:selected="${selectedPatient != null && selectedPatient.id == patient.id}">
                        </option>
                    </select>
                </div>
            </form>
        </div>

        <div th:if="${selectedPatient != null}" class="section">
            <h2 th:text="${selectedPatient.name + ' - Growth Analytics'}">Patient Name - Growth Analytics</h2>
            
            <div class="grid">
                <div class="card">
                    <h3>Height Growth</h3>
                    <div class="chart-container">
                        <!-- Height growth chart will be rendered here -->
                        <img th:src="@{/api/charts/height(childId=${selectedPatient.id})}" alt="Height Growth Chart" class="chart">
                    </div>
                </div>
                
                <div class="card">
                    <h3>Weight Growth</h3>
                    <div class="chart-container">
                        <!-- Weight growth chart will be rendered here -->
                        <img th:src="@{/api/charts/weight(childId=${selectedPatient.id})}" alt="Weight Growth Chart" class="chart">
                    </div>
                </div>
                
                <div class="card">
                    <h3>BMI Trend</h3>
                    <div class="chart-container">
                        <!-- BMI trend chart will be rendered here -->
                        <img th:src="@{/api/charts/bmi(childId=${selectedPatient.id})}" alt="BMI Trend Chart" class="chart">
                    </div>
                </div>
                
                <div class="card">
                    <h3>Head Circumference</h3>
                    <div class="chart-container">
                        <!-- Head circumference chart will be rendered here -->
                        <img th:src="@{/api/charts/head(childId=${selectedPatient.id})}" alt="Head Circumference Chart" class="chart">
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3>Growth Percentiles</h3>
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Measurement</th>
                                <th>Current Value</th>
                                <th>Percentile</th>
                                <th>Status</th>
                                <th>Recommendation</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Height</td>
                                <td th:text="${#numbers.formatDecimal(latestRecord.height, 1, 2) + ' cm'}"></td>
                                <td th:text="${heightPercentile + '%'}"></td>
                                <td>
                                    <span th:class="${heightStatus == 'NORMAL' ? 'badge badge-success' : (heightStatus == 'BELOW' ? 'badge badge-warning' : 'badge badge-danger')}"
                                          th:text="${heightStatus}"></span>
                                </td>
                                <td th:text="${heightRecommendation}"></td>
                            </tr>
                            <tr>
                                <td>Weight</td>
                                <td th:text="${#numbers.formatDecimal(latestRecord.weight, 1, 2) + ' kg'}"></td>
                                <td th:text="${weightPercentile + '%'}"></td>
                                <td>
                                    <span th:class="${weightStatus == 'NORMAL' ? 'badge badge-success' : (weightStatus == 'BELOW' ? 'badge badge-warning' : 'badge badge-danger')}"
                                          th:text="${weightStatus}"></span>
                                </td>
                                <td th:text="${weightRecommendation}"></td>
                            </tr>
                            <tr>
                                <td>BMI</td>
                                <td th:text="${#numbers.formatDecimal(latestRecord.bmi, 1, 2)}"></td>
                                <td th:text="${bmiPercentile + '%'}"></td>
                                <td>
                                    <span th:class="${bmiStatus == 'NORMAL' ? 'badge badge-success' : (bmiStatus == 'BELOW' ? 'badge badge-warning' : 'badge badge-danger')}"
                                          th:text="${bmiStatus}"></span>
                                </td>
                                <td th:text="${bmiRecommendation}"></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="section">
                <h3>Add Medical Notes</h3>
                <form th:action="@{/doctor/patient/{id}/add-notes(id=${selectedPatient.id})}" method="post" class="form" 
                    <div class="form-group">
                        <label for="notes">Notes</label>
                        <textarea id="notes" name="notes" class="form-control" rows="4" required></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary">Save Notes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
</html> 